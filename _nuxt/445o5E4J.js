import{a as X,ag as H,ah as J,u as Y,Q as Z,b as ee,ai as te,X as ae,aj as le,aa as ne,a9 as ue,ae as L,af as se,ad as oe,a8 as ie,ab as E,ac as $}from"./DUMfIODN.js";import{K as Q,L as re,aP as de,M as ce,a3 as fe,ar as ve,i as m,r as D,a1 as me,F as j,a6 as pe,z as o,V as ye,W as z,am as q,R as ge,d as be,aQ as Ve,aR as xe,t as I,v as K,az as x,aG as M,A as O,aA as R,x as h,B as w,aD as C,m as he,q as ke}from"./uacIu_m8.js";const Ae=()=>{const e=Q("isVerify",()=>!1);return{isVerify:e,setVerify:V=>{e.value=V}}},we=()=>{const e=Q("datas",()=>null);return{datas:e,setDatas:V=>{e.value=V}}},Ce=re({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...X(),...H(),...de(J({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),De=ce()({name:"VOtpInput",props:Ce(),emits:{finish:e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,k){let{attrs:V,emit:F,slots:s}=k;const{dimensionStyles:B}=Y(e),{isFocused:i,focus:P,blur:S}=Z(e),r=fe(e,"modelValue","",t=>t==null?[]:String(t).split(""),t=>t.join("")),{t:N}=ve(),f=m(()=>Number(e.length)),_=m(()=>Array(f.value).fill(0)),l=D(-1),p=D(),v=D([]),A=m(()=>v.value[l.value]);function y(){if(T(A.value.value)){A.value.value="";return}const t=r.value.slice(),a=A.value.value;t[l.value]=a;let d=null;l.value>r.value.length?d=r.value.length+1:l.value+1!==f.value&&(d="next"),r.value=t,d&&q(p.value,d)}function n(t){const a=r.value.slice(),d=l.value;let c=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(t.key)&&(t.preventDefault(),t.key==="ArrowLeft"?c="prev":t.key==="ArrowRight"?c="next":["Backspace","Delete"].includes(t.key)&&(a[l.value]="",r.value=a,l.value>0&&t.key==="Backspace"?c="prev":requestAnimationFrame(()=>{var u;(u=v.value[d])==null||u.select()})),requestAnimationFrame(()=>{c!=null&&q(p.value,c)}))}function g(t,a){var c,u,b;a.preventDefault(),a.stopPropagation();const d=(u=(c=a==null?void 0:a.clipboardData)==null?void 0:c.getData("Text").slice(0,f.value))!=null?u:"";T(d)||(r.value=d.split(""),(b=v.value)==null||b[t].blur())}function U(){r.value=[]}function G(t,a){P(),l.value=a}function W(){S(),l.value=-1}function T(t){return e.type==="number"&&/[^0-9]/g.test(t)}return me({VField:{color:m(()=>e.color),bgColor:m(()=>e.color),baseColor:m(()=>e.baseColor),disabled:m(()=>e.disabled),error:m(()=>e.error),variant:m(()=>e.variant)}},{scoped:!0}),j(r,t=>{t.length===f.value&&F("finish",t.join(""))},{deep:!0}),j(l,t=>{t<0||ge(()=>{var a;(a=v.value[t])==null||a.select()})}),ee(()=>{var d;const[t,a]=pe(V);return o("div",z({class:["v-otp-input",{"v-otp-input--divided":!!e.divider},e.class],style:[e.style]},t),[o("div",{ref:p,class:"v-otp-input__content",style:[B.value]},[_.value.map((c,u)=>o(ye,null,[e.divider&&u!==0&&o("span",{class:"v-otp-input__divider"},[e.divider]),o(te,{focused:i.value&&e.focusAll||l.value===u,key:u},{...s,loader:void 0,default:()=>o("input",{ref:b=>v.value[u]=b,"aria-label":N(e.label,u+1),autofocus:u===0&&e.autofocus,autocomplete:"one-time-code",class:["v-otp-input__field"],disabled:e.disabled,inputmode:e.type==="number"?"numeric":"text",min:e.type==="number"?0:void 0,maxlength:"1",placeholder:e.placeholder,type:e.type==="number"?"text":e.type,value:r.value[u],onInput:y,onFocus:b=>G(b,u),onBlur:W,onKeydown:n,onPaste:b=>g(u,b)},null)})])),o("input",z({class:"v-otp-input-input",type:"hidden"},a,{value:r.value.join("")}),null),o(ae,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!e.loading,persistent:!0},{default:()=>{var c,u;return[(u=(c=s.loader)==null?void 0:c.call(s))!=null?u:o(le,{color:typeof e.loading=="boolean"?void 0:e.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(d=s.default)==null?void 0:d.call(s)])])}),{blur:()=>{var t;(t=v.value)==null||t.some(a=>a.blur())},focus:()=>{var t;(t=v.value)==null||t[0].focus()},reset:U,isFocused:i}}}),Fe={key:2,class:"py-8 px-6 text-center mx-auto ma-4",elevation:"12","max-width":"400",width:"100%"},Se=be({__name:"index",setup(e){const k=ke(),V=Ve("userInfo"),{exception:F,setException:s}=ne(),{isLoading:B,setLoading:i}=ue(),{isVerify:P,setVerify:S}=Ae(),{account:r,setAccount:N}=xe(),{datas:f,setDatas:_}=we(),l=D(),p=D();i(!1),S(!1);const v=async()=>{if(s(null),i(!0),C(l.value))s("メールアドレスを入力してください。"),i(!1);else{const{data:y,pending:n}=await $("item",()=>$fetch("".concat(k.public.apiOptVerifyCheck),{method:"POST",body:{email:l.value}}));C(y.value)?(s("システムエラーが発生しました。"),i(!1)):(_(y.value),i(!1),f.value.success?S(!0):s(f.value.message))}},A=async()=>{if(s(null),i(!0),C(p.value))s("認証番号を入力してください。"),i(!1);else{const{data:y,pending:n}=await $("item",()=>$fetch("".concat(k.public.apiOptVerifyAccount),{method:"POST",body:{email:l.value,pin_number:p.value}}));if(C(y.value))s("システムエラーが発生しました。"),i(!1);else if(_(y.value),i(!1),!f.value.success)s(f.value.message);else{const g={isVerify:!0,email:l.value};V.value=g,N(g),await he("/calendar")}}};return(y,n)=>(I(),K("div",null,[x(C)(x(F))?R("",!0):(I(),M(L,{key:0,class:"mx-auto",width:"95%"},{default:O(()=>[o(oe,{text:x(F),title:"エラー",type:"error"},null,8,["text"])]),_:1})),x(P)?R("",!0):(I(),M(L,{key:1,class:"mx-auto margin-top_20",width:"80%"},{default:O(()=>[n[3]||(n[3]=h("h3",{class:"text-h6 mb-4"},"アカウント認証",-1)),o(ie,{label:"E-mail",variant:"outlined","single-line":"",modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=g=>l.value=g)},null,8,["modelValue"]),o(E,{disabled:x(B),loading:x(B),class:"text-none mb-4",color:"indigo-darken-3",size:"x-large",variant:"flat",block:"",onClick:v},{default:O(()=>n[2]||(n[2]=[w(" メール認証 ")])),_:1},8,["disabled","loading"])]),_:1})),x(P)?(I(),K("div",Fe,[n[4]||(n[4]=h("h3",{class:"text-h6 mb-4"},"アカウント認証",-1)),n[5]||(n[5]=h("div",{class:"text-body-2"},[w(" 入力したメールアドレスを確認後、"),h("br"),w(" 認証番号をメールに送り致します。"),h("br"),w(" しばらくして、メールを確認してください。 ")],-1)),o(se,{color:"surface"},{default:O(()=>[o(De,{modelValue:p.value,"onUpdate:modelValue":n[1]||(n[1]=g=>p.value=g),type:"password",variant:"solo"},null,8,["modelValue"])]),_:1}),o(E,{class:"my-4",color:"light-blue-darken-2",height:"40",text:"コード認証",variant:"flat",width:"70%",onClick:A}),n[6]||(n[6]=h("div",{class:"text-caption"},[w(" 認証メールが届いてない場合、 "),h("a",{href:"#"},"再送信")],-1))])):R("",!0)]))}});export{Se as default};
